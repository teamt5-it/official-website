<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TeamT5 - Persistent Cyber Threat Hunters</title>
  <meta
    name="description"
    content="TeamT5 is a group of hackers dedicated on cyber threat research. The team started with their outstanding research and has been delivering their cyber threat intelligence (CTI) for more than 5 years."
  />
  <meta
    name="keywords"
    content="TeamT5, ThreatSonar, ThreatVision, cyber espionage, TT, Cyber Threat Hunters, cyber espionage solutions, threat analysis service, incident response, investigation services, threat intelligence, Elegant Threat Hunting Technology"
  />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    property="og:title"
    content="TeamT5 - Persistent Cyber Threat Hunters"
  />
  <meta
    property="og:description"
    content="TeamT5 is a group of hackers dedicated on cyber threat research. The team started with their outstanding research and has been delivering their cyber threat intelligence (CTI) for more than 5 years."
  />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/assets/images/og-image.jpg" />
  <link
    href="https://fonts.googleapis.com/css?family=Noto+Sans+TC:400,500,700&display=swap&subset=chinese-traditional"
    rel="stylesheet"
  />
  <link rel="icon" type="image/icon" href="/assets/images/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="/assets/main-7383437ebdec817d69f1db11a083c62e3d6f5c775a35fc8ee18b88c67dc2c866.css" integrity="sha256-c4NDfr3sgX1p8dsRoIPGLj1vXHdaNfyO4YuIxn3CyGY=" crossorigin="anonymous"> <script integrity="sha256-ZXwkbee/Uwspyw5FDzhhG6YQBtn5LFRLCRt2xMtBSIk=" crossorigin="anonymous" src="/assets/main-657c246de7bf530b29cb0e450f38611ba61006d9f92c544b091b76c4cb414889.js" type="text/javascript"></script>
</head>


<body>
  <div class="header-container">
    <header class="navbar">
    <div class="navbar-brand-and-menu">

        <div class="navbar-brand">
            <a class="navbar-brand-logo" href="/">
                <object data="/assets/header/header-logo-3b363715bccbf56e1d1f26d37b954be04245a4e6bf74e4e5dc466c8fc624aa6b.svg">
                </object>
            </a>
            <div class="navbar-burger">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </div>
        </div>
        <div class="navbar-menu">
            <div class="navbar-item navbar-item-has-submenu">
                <div class="navbar-item-link
            
                
            ">
                    <div class="navbar-item-title title">
                        Products
                    </div>
                    <div class="navbar-item-arrow">
                        <object data="/assets/arrow-down-grey-color-c386e3d166125119750898fef68303e4aeafc8670b11bccdd778363c6e02f8b9.svg">
                        </object>
                    </div>
                </div>
                <div class="navbar-submenu">
                    <a class="navbar-submenu-item-link" href="/products/threatsonar/">
                        <div class="navbar-submenu-item title">
                            ThreatSonar
                        </div>
                    </a>
                    <a class="navbar-submenu-item-link" href="/products/threatvision/">
                        <div class="navbar-submenu-item title">
                            ThreatVision
                        </div>
                    </a>
                </div>
            </div>
            <div class="navbar-item">
                <a class="navbar-item-link
            
            " href="/partners/">
                    <div class="navbar-item-title title">
                        Partners
                    </div>
                </a>
            </div>
            <div class="navbar-item">
                <a class="navbar-item-link
            
            " href="/blog/">
                    <div class="navbar-item-title title">
                        Blog
                    </div>
                </a>
            </div>
            <div class="navbar-item navbar-item-has-submenu">
                <div class="navbar-item-link

            
                
            ">
                    <div class="navbar-item-title title">
                        Company</div>
                    <div class="navbar-item-arrow">
                        <object data="/assets/arrow-down-grey-color-c386e3d166125119750898fef68303e4aeafc8670b11bccdd778363c6e02f8b9.svg">
                        </object>
                    </div>
                </div>
                <div class="navbar-submenu">
                    <a class="navbar-submenu-item-link" href="/about-us/">
                        <div class="navbar-submenu-item title">
                            About us
                        </div>
                    </a>
                    <a class="navbar-submenu-item-link" href="/contact-us/">
                        <div class="navbar-submenu-item title">
                            Contact us
                        </div>
                    </a>
                    <a class="navbar-submenu-item-link" href="/careers/">
                        <div class="navbar-submenu-item title">
                            Careers
                        </div>
                    </a>
                    <a class="navbar-submenu-item-link" href="/newsroom/">
                        <div class="navbar-submenu-item title">
                            Newsroom
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="navbar-submenu-padding">
        <div class="navbar-submenu-padding-box">

        </div>
    </div>
</header>

  </div>
  <div class="main-container">
    <div class="post-page-title-container">
    <div class="post-page-title">
        <div class="post-page-title-content title title-leftline ">
            中國駭客HUAPI的惡意後門程式BiFrost分析
        </div>
    </div>
</div>

<main class="post-layout">
    <div class="post-meta">
        
        <div class="post-date date">
            2020/04/15
        </div>
    </div>
    <div class="post-banner">
        <img class="lazy" data-src="/assets/images/123123.jpg">
    </div>
    <div class="post-content content">
        <p><strong>關鍵字: HUAPI、PLEAD、GhostCat、CVE-2020-1938、Linux、BiFrost、RC4、RAT</strong></p>

<h3 id="前言">前言</h3>

<p>TeamT5近期接獲情資，於台灣某學術網路的圖書館網站上發現存有惡意程式。經過TeamT5研究員分析調查發現，該網站系統使用Tomcat 7.0.73作為網頁伺服器且開啟8009通訊埠，TeamT5研究員驗證網站具有Ghostcat(CVE-2020-1938)漏洞，詳見下圖。</p>

<p><img src="/assets/images/upload_138de179b305a67f8ac53a04e7a7b76f.png" alt="" />
<em>圖一、Nmap掃描結果</em></p>

<p>駭客利用Tomcat網頁伺服器預設開啟的AJP服務(預設為8009通訊埠)，可達到遠端指令執行(Remote Code Execution, RCE)之目的並上傳檔案。於該案例中，駭客疑似透過Ghostcat漏洞上傳BiFrost惡意程式，使該圖書館系統成為惡意程式下載站(Download Site)。</p>

<h3 id="惡意程式分析">惡意程式分析</h3>

<p>該惡意程式(8fd3925dadf37bebcc8844214f2bcd18)於2020/01/31被上傳至Virustotal平台，當時的各家防毒軟體的偵測率並不佳，僅有6家防毒軟體能夠有效識別，詳見下圖。</p>

<p><img src="/assets/images/upload_182fbfe213a00905cb7703968c5b4303.png" alt="" />
<em>圖二、惡意程式於一月底上傳至VirusTotal且一開始防毒軟體的偵測率並不佳</em></p>

<p>TeamT5取得該惡意後門程式並進行分析，該惡意後門程式檔名為md.png，但檔案格式為UNIX ELF執行檔，推測是利用PNG副檔名偽裝在Tomcat網站伺服器上，詳見下圖。</p>

<p><img src="/assets/images/upload_252083b0a86403a0de983e7c0c23f7ea.png" alt="" />
<em>圖三、偽裝為PNG的ELF執行檔</em></p>

<p>使用TeamT5的ThreatSonar惡意威脅鑑識系統可有效辨識出該惡意程式並可以偵測到中繼站IP位址(107.191.61.247)，詳見下圖。</p>

<p><img src="/assets/images/BLOG替換圖片.png" alt="" />
<em>圖四、ThreatSonar偵測畫面</em></p>

<p>經過逆向分析，該惡意後門程式具有上傳/下載/列舉/刪除/搬移檔案(File)、執行/結束程序(Process)、開啟/關閉遠端命令列介面程式(Remote Shell)等功能，其中惡意後門程式與中繼站的連線內容會使用修改過的RC4演算法進行加密，此專屬特徵可用來辯認出此惡意程式，詳見下圖。</p>

<p><img src="/assets/images/upload_510cf4aa9e8eb340173d57162e662d1a-1.png" alt="" />
<em>圖五、惡意後門程式使用修改後的RC4加密演算法</em></p>

<h3 id="攻擊族群分析">攻擊族群分析</h3>

<p>該惡意程式為Linux版本的BiFrost後門程式，其版本號為5.0.0.0。根據TeamT5長期研究的情資顯示，該惡意程式為中國駭客組織HUAPI (又名為PLEAD) 慣用的後門程式。HUAPI駭客組織自2007年開始活躍至今，攻擊台灣超過10年的時間。TeamT5觀察到HUAPI所開發的惡意程式有時會使用加殼來阻擋研究人員分析，且通常會使用修改後的RC4演算法來加密傳輸。HUAPI長期攻擊政府、高科技、電信或研究智庫單位，根據TeamT5的統計結果，超過5成的受害單位為政府機關，受害國家包含台灣、美國、日本及南韓，其中針對台灣政府機關進行入侵攻擊的為多。</p>

<h3 id="影響與建議">影響與建議</h3>

<p>若用戶有使用Tomcat服務作為網頁伺服器，且版本為以下之一者：</p>

<ul>
  <li>Apache Tomcat 9.x &lt; 9.0.31</li>
  <li>Apache Tomcat 8.x &lt; 8.5.51</li>
  <li>Apache Tomcat 7.x &lt; 7.0.100</li>
  <li>Apache Tomcat 6.x</li>
</ul>

<p>TeamT5建議需要立即進行版本更新，避免遭到駭客利用Ghostcat漏洞進行遠端控制，甚至上傳惡意檔案。</p>

<p>另外，若用戶若遭遇針對性進階持續威脅(Advanced Persistent Threat, APT)時，則需要使用如TeamT5的ThreatSonar惡意威脅鑑識系統，IT管理者可以在最短時間內偵測並回應這類的惡意威脅。TeamT5建議可將下方威脅指標(Indicator of Compromise, IOC)匯入到各式資安設備中偵測與識別威脅。</p>

<ul>
  <li>107.191.61.247</li>
  <li>8fd3925dadf37bebcc8844214f2bcd18</li>
  <li>
    <p>Yara Rule</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rule RAT_BiFrost_UNIX
{
    meta:
    description= "HUAPI UNIX BiFrost RAT"
    author = "TeamT5"
    date = "2020-04-15"
  
    strings:
    $hex1 = {25 ?? 00 00 00 85 C0 75 37 8B 45 F0 89 C1 03 4D 08 8B 45 F0 03 45 08 0F B6 10 8B 45 F8 01 C2 B8 FF FF FF FF 21 D0 88 01 8B 45 F0 89 C2 03 55 08 8B 45 F0 03 45 08 0F B6 00 32 45 FD 88 02}
    $hex2 = {8B 45 F0 03 45 08 0F B6 00 30 45 FD 8B 45 F0 89 C1 03 4D 08 8B 45 F8 89 C2 02 55 FD B8 FF FF FF FF 21 D0 88 01}
  
    condition:
    all of them
}
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="外部參考資料">外部參考資料</h3>

<ol>
  <li>https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-1938</li>
</ol>

    </div>
    
        
    
    <a class="back-button button">
        Back
    </a>
</main>

  </div>
  <div class="footer-container">
    <footer class="footer">
    <div class="footer-logo-and-menu">
        <a class="footer-logo" href="/">
            <object data="/assets/footer/footer-logo-7feae84ff8f4616ae82197cdcb4b63d2af93c4d247b9106328f14c734e270d62.svg">
            </object>
        </a>
        <div class="footer-menu">
            <div class="footer-item">
                <div class="footer-item-title">Products</div>
                <a class="footer-item-link" href="/products/threatsonar/">ThreatSonar</a>
                <a class="footer-item-link" href="/products/threatvision/">ThreatVision</a>

            </div>
            <div class="footer-item">
                <a class="footer-item-title footer-item-link" href="/partners/">Partners</a>
                <a class="footer-item-title footer-item-link" href="/blog/">Blog</a>
            </div>
            <div class="footer-item">
                <div class="footer-item-title">Company</div>
                <a class="footer-item-link" href="/about-us/">About us</a>
                <a class="footer-item-link"
                    href="/contact-us/">Contact us</a>
                <a class="footer-item-link" href="/careers/">Careers</a>
                <a class="footer-item-link" href="/newsroom/">Newsroom</a>
            </div>
        </div>
    </div>
    <hr class="footer-hr">
    <div class="footer-informations-and-language-selector">
        <div class="footer-informations">
            <div class="footer-copyright">
                © 2019 Team T5, Inc. (Doppler Cyber Threat Solutions Inc.) All Rights Reserved.
            </div>
            <div class="footer-privacy-and-cookies-policy">
                <a href="/privacy-and-cookies-policy/">Privacy & Cookies Policy</a>
            </div>
            <div class="footer-terms-of-service">
                <a href="/terms-of-service/">Terms of Service</a>
            </div>
        </div>
        <select class="footer-language-selector" id="language-selector">
            <option value="en">English</option>
            <option value="zh">中文</option>
        </select>
    </div>
    <div class="scroll-top">
        <div class="scroll-top-square rotate-clockwise-45">
            <div class="scroll-top-content rotate-counterwise-45">
                <object class="scroll-top-arrow" data="/assets/arrow-up-78bf1dbc7f5b78b1750c58ebad959a4caea323d635c30863521203c878f2ab97.svg">
                </object>
                <div class="scroll-top-text">
                    TOP
                </div>
            </div>
        </div>
    </div>
</footer>

  </div>
</body>

</html>
